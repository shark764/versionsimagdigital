{# empty Twig template #}

{% extends 'MinsalSimagdBundle::simagd_base_list.html.twig' %}

{% set _minWarning = 8 %}
{% set _minDanger = 5 %}

{% block javascripts %}
    {{ parent() }}

    {% include 'MinsalSimagdBundle:ImagenologiaDigitalAdmin:simagd_proximaConsulta.js.twig'
                                    ignore missing with { '_msjTitle': 'Transcripciones pendientes:',
                                                            '_minWarning': _minWarning,
                                                            '_minDanger': _minDanger,
                                                         } %}
{% endblock %}

{% block simagd_form_navbar_brand_title %}
    <span class="navbar-brand"><span class="label label-primary-v4"> <i class="fa fa-clipboard"></i> Diagnósticos radiológicos transcritos </span></span>
{% endblock %}

{% block actions %}
    {% spaceless %}
        {# sin actions #}
    {% endspaceless %}
{% endblock %}

{% block table_body %}
    <tbody>

        {% set _showPendienteRow = false %}
        
	{% if ( is_granted('ROLE_MINSAL_SIMAGD_ADMIN_IMG_DIAGNOSTICO_CREATE') or is_granted('ROLE_MINSAL_SIMAGD_ADMIN_IMG_DIAGNOSTICO_EDIT') ) or is_granted('ROLE_ADMIN') %}

            {% set _showPendienteRow = true %}

	{% endif %}

        {% for object in admin.datagrid.results %}
        
            {% if _showPendienteRow %}
        
                {% if object.idEstadoDiagnostico.id not in [3, 5, 6] %}

                    {% set _preEstudio = object.idLectura.idEstudio.idProcedimientoRealizado.idSolicitudEstudio.requiereDiagnostico %}

                    {% if _preEstudio %}

                        {% set _proximaConsulta = object.idLectura.idEstudio.idProcedimientoRealizado.idSolicitudEstudio.fechaProximaConsulta %}
                        {% set _proximaConsultaTitle = 'Próxima consulta médica:\n' ~ _proximaConsulta|format_date('EEEE, MMMM d, yyyy', 'es_ES') %}

                        {% include 'MinsalSimagdBundle:ImagenologiaDigitalAdmin:simagd_rowFechaPendiente.html.twig'
                                        ignore missing with { '_proximaConsulta': _proximaConsulta,
                                                                '_proximaConsultaTitle': _proximaConsultaTitle,
                                                                '_warningRow': _minWarning,
                                                                '_dangerRow': _minDanger,
                                                             } %}

                    {% else %}
                        {{ render(controller( 'MinsalSimagdBundle:ImgLecturaAdmin:proximaConsulta',
                                                            { 'idEstudioPadre' : object.idLectura.idEstudio.id,
                                                                'warningRow': _minWarning,
                                                                'dangerRow': _minDanger,
                                                                '_sonata_admin' : 'minsal_simagd.admin.img_lectura' } )) }}

                    {% endif %}

                {% else %}
                    <tr>
                {% endif %}
        
            {% else %}
                <tr>
            {% endif %}
        
                {% include admin.getTemplate('inner_list_row') %}
            </tr>
        {% endfor %}
    
    </tbody>
{% endblock %}