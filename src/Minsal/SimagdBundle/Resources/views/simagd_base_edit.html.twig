{# empty Twig template #}

{# /** SIMAGD EDIT TEMPLATE, extiende de CRUD:base_edit **/ #}

{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% set _messageCurrentTemplate = action is defined and action == 'edit' ?
                        '<i class="fa fa-refresh"></i> <i class="fa fa-pencil-square-o"></i> Edición de registro' :
                        '<i class="fa fa-floppy-o"></i> <i class="fa fa-plus-circle"></i> Nuevo registro' %}

{% block stylesheets %}
    {{ parent() }}
    
    {# Bootstrap #}
    {#<link href="{{ asset('bundles/minsalsimagd/bootstrap-3.3.4-dist/css/bootstrap.min.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-3.3.4-dist/css/bootstrap-theme.min.css') }}" type="text/css" rel="stylesheet" />#}
    
    {# simagd-styles #}
    <link href="{{ asset('bundles/minsalsimagd/css/simagd-styles.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('bundles/minsalsimagd/css/simagd-form-styles.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('bundles/minsalsimagd/css/simagd-table.css') }}" type="text/css" rel="stylesheet" />
    
    {# jquery-ui #}
    <link href="{{ asset('bundles/minsalsimagd/jquery-ui-1.11.2.custom/jquery-ui.theme.min.css') }}" type="text/css" rel="stylesheet" />
    
    {# Bootstrap-calendar #}
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-datetimepicker-development/build/css/bootstrap-datetimepicker.min.css') }}" type="text/css" rel="stylesheet" />
    
    {# iCheck #}
    <link href="{{ asset('bundles/minsalsimagd/iCheck-master/skins/minimal/blue.css') }}" type="text/css" rel="stylesheet" />
    
    {# ckeditor #}
    <link href="{{ asset('bundles/minsalsimagd/css/simagd-ckeditor.css') }}" type="text/css" rel="stylesheet" />
    
    {# Twitter Typeahead #}
    <link href="{{ asset('bundles/minsalsimagd/css/typeahead.css') }}" type="text/css" rel="stylesheet" />
    
    {# bootstrap-table #}
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-table-master/dist/bootstrap-table.min.css') }}" type="text/css" rel="stylesheet" media="screen" />
    
    {# bootstrapvalidator #}
    <link href="{{ asset('bundles/minsalsimagd/formvalidation-master/dist/css/formValidation.min.css') }}" type="text/css" rel="stylesheet" />
    
    {# toastmessage #}
    <link href="{{ asset('bundles/minsalsimagd/toastmessage-plugin/src/main/resources/css/jquery.toastmessage.css') }}" type="text/css" rel="stylesheet" />
    
    {# bootstrap-modal #}
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-modal-master/css/bootstrap-modal-bs3patch.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-modal-master/css/bootstrap-modal.css') }}" type="text/css" rel="stylesheet" />
    
    {# bootstrap-vertical-tabs #}
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-vertical-tabs-1.2.1/bootstrap.vertical-tabs.css') }}" type="text/css" rel="stylesheet" />
    
    {# bootstrap-switch #}
    <link href="{{ asset('bundles/minsalsimagd/bootstrap-switch-master/dist/css/bootstrap3/bootstrap-switch.min.css') }}" type="text/css" rel="stylesheet" />
    
    {# select2-bootstrap #}
    <link href="{{ asset('bundles/minsalsimagd/css/select2-bootstrap.css') }}" type="text/css" rel="stylesheet" />
{% endblock %}
    
{% block javascripts %}
    {{ parent() }}

    <script>
	var $token,
	    $current_action_form,
	    $object_id,
            $is_objectAllowToSwitch;
	
	var $is_admin,
	    $is_radX,
	    $is_prcMed;
	    
	var $id_userLogged,
	    $id_emp_userLogged,
	    $cod_emp_userLogged,
	    $id_userEstab;

	$token 			= "{{ admin.uniqId }}";
	$current_action_form 	= {% if  action is defined %} "{{ action }}" {% else %} "create" {% endif %};
	$object_id 		= {% if admin.id(object) is not null %} {{ object.id }} {% else %} false {% endif %};
	$is_admin 		= {% if is_granted('ROLE_ADMIN') %} true {% else %} false {% endif %};

	console.log($token, $current_action_form, $object_id);
	
	$is_admin		= {% if is_granted('ROLE_ADMIN') %} true {% else %} false {% endif %};
	$is_radX		= {% if is_granted('ROLE_MINSAL_SIMAGD_ADMIN_IMG_LECTURA_CREATE') %} true {% else %} false {% endif %};
	$is_prcMed		= {% if is_granted('ROLE_MINSAL_SIMAGD_ADMIN_IMG_SOLICITUD_ESTUDIO_CREATE') and app.user.idEmpleado.idTipoEmpleado.codigo == 'MED' %} true {% else %} false {% endif %};

	console.log($is_admin, $is_radX, $is_prcMed);
	
	$id_userLogged		= {{ app.user.getId()|escape('js') }};
	$id_emp_userLogged	= {{ app.user.getIdEmpleado.getId()|escape('js') }};
	$cod_emp_userLogged	= "{{ app.user.getIdEmpleado.getIdTipoEmpleado.getCodigo()|escape('js') }}";
	$id_userEstab 		= {{ app.user.getIdEstablecimiento.getId()|escape('js') }};

	console.log($id_userLogged, $id_emp_userLogged, $cod_emp_userLogged, $id_userEstab);
    </script>
    
    {# Bootstrap #}
    {#<script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-3.3.4-dist/js/bootstrap.min.js') }}" ></script>#}

    {# select2-es #}
    <script type="text/javascript" src="{{ asset('/bundles/sonataadmin/vendor/select2/select2_locale_es.js') }}" ></script>
    
    {# iCheck #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/iCheck-master/icheck.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_form_config.js') }}" ></script>
    
    {# jquery-ui #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/jquery-ui-1.11.2.custom/jquery-ui.min.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_highlight_error_ui.js') }}" ></script>

    {# jquery-formparams #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/jquery.formparams.min.js') }}" ></script>

    {# jquery-maskedinput #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/jquery.mask.min.js') }}" ></script>
    
    {# Simagd extend jQuery #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_jQueryCustomFunctions.js') }}" ></script>
    
    {# Twitter Typeahead #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/typeahead.js-master/dist/typeahead.bundle.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/typeahead.js-master/dist/bloodhound.js') }}" ></script>
    
    {# bootstrap-table #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-table-master/dist/bootstrap-table.min.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-table-master/dist/locale/bootstrap-table-es-CR.min.js') }}" ></script>
    {# data format for bootstrap-table #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_data_bsTable_formatter.js') }}" ></script>
    {# filters for bootstrap-table #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_filter_bstable_config.js') }}" ></script>
    
    {# Bootstrap-calendar #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/moment-master/min/moment-with-locales.min.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-datetimepicker-development/build/js/bootstrap-datetimepicker.min.js') }}" ></script>
    
    {# simagd-functions #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_trim_datos.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_html5_novalidate.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_validate_number.js') }}" ></script>
    
    {# Simagd Custom Scripts #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_form_config_v2.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_config_alert.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_setterObject_modalData.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_select2_custom_formatter.js') }}" ></script>
    
    {# bootstrapvalidator #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/formvalidation-master/dist/js/formValidation.min.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/formvalidation-master/dist/js/framework/bootstrap.min.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/formvalidation-master/dist/js/language/es_ES.js') }}" ></script>
    
    {# toastmessage #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/toastmessage-plugin/src/main/javascript/jquery.toastmessage.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/js/simagd_generar_mensaje_toast.js') }}" ></script>
    
    {# bootstrap-modal #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-modal-master/js/bootstrap-modalmanager.js') }}" ></script>
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-modal-master/js/bootstrap-modal.js') }}" ></script>
    
    {# bootstrap-switch #}
    <script type="text/javascript" src="{{ asset('bundles/minsalsimagd/bootstrap-switch-master/dist/js/bootstrap-switch.min.js') }}" ></script>
    
    {% include 'MinsalSimagdBundle:ImagenologiaDigitalAdmin:simagd_funcionesClienteServidor.js.twig' %}
{% endblock %}

{% block sonata_page_content_header %}
    {% block sonata_page_content_nav %}
        {% if _tab_menu is not empty or _actions is not empty %}
            <nav class="navbar navbar-default" role="navigation">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    {% block tab_menu_navbar_header %}
                        <div class="navbar-header">
                            <button type="button"    class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            {% block simagd_form_navbar_brand_title %}
                                <span class="navbar-brand">
                                    <span class="label label-{{ action is defined and action == 'edit' ? 'primary-v2' : 'element-v2' }}"> {{ _messageCurrentTemplate|truncate(150)|raw }} </span>
                                </span>
                            {% endblock %}
                        </div>
                    {% endblock %}

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            {% block simagd_navbar_left_nav %}
                                {# add custom items #}
                                <div style="padding-top: 8px;">
                                    <input type="checkbox" name="switch_for_form_and_register" data-apply-bootstrap-switch="true" checked data-on-text="{#<span class='glyphicon glyphicon-edit' aria-hidden='true'></span>#} Formulario" data-off-text="{#<span class='glyphicon glyphicon-folder-open' aria-hidden='true'></span>#} Registros" data-label-text="Vista" data-inverse="true" class="chk-bsswitch-container" />
                                </div>
                                {% if _tab_menu is not empty %}
                                    {{ _tab_menu|raw }}
                                {% endif %}
                            {% endblock %}
                        </ul>
                        {% block simagd_navbar_middle_nav %}
                            {# add custom items, you can add a form #}
                        {% endblock %}
                        <ul class="nav navbar-nav navbar-right">
                            {% if _actions|replace({ '<li>': '', '</li>': '' })|trim is not empty %}
                                {{ _actions|raw }}
                            {% endif %}
                            {% block simagd_navbar_right_nav %}
                            {% endblock %}
                        </ul>
                    </div><!-- /.navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
        {% endif %}
    {% endblock sonata_page_content_nav %}

{% endblock sonata_page_content_header %}
    
{% block content %}
    
    {% block notice %}
        {% include 'MinsalSimagdBundle::simagd_flash_notice.html.twig' %}
    {% endblock notice %}
    
    {{ parent() }}
    
    {% block simagd_info_support %}

        <div id="simagd-modal-info-support" class="modal container fade justify-bootstrap-div-container" role="dialog" tabindex="-1" style="display: none;" data-backdrop="static" data-keyboard="false">
            <div class="modal-content panel-primary-v2">
                <div class="modal-header panel-heading">
                    <button type="button"    class="close" data-dismiss="modal" aria-hidden="true"> <i class="fa fa-times"></i> </button>
                    <h4 class="modal-title"><i class="fa fa-desktop"></i> <strong>Imagenología</strong> - Cuadro informativo</h4>
                </div>
                
                <div class="modal-body" >

                    <div class="panel panel-primary">

                        <div class="panel-heading">
                            <h3 class="panel-title"><i class="fa fa-random"></i> Información de registros </h3>
                        </div>

                        <div class="panel-body" >

                            {% block custom_entity_support %}

                                <div id="custom-entity-content-body"> {# Bloque a reemplazar para información en boostrap-modal #} </div>

                            {% endblock %}

                        </div>{# body #}

                    </div><!-- /.modal-content -->

                </div>{# body #}

                <div class="modal-footer">
                    <button type="button"    data-dismiss="modal" class="btn btn-primary-v2 btn-outline"> <i class="fa fa-times"></i> Cerrar </button>
                </div>

            </div><!-- /.modal-content -->

        </div>{# modal #}

    {% endblock %}
    
{% endblock %}

{% block form %}
    {{ sonata_block_render_event('sonata.admin.edit.form.top', { 'admin': admin, 'object': object }) }}

    {% set url              = admin.id(object) is not null ? 'edit' : 'create' %}
    
    {% set __my_form_type   = 'horizontal' %}

    {% if not admin.hasRoute(url)%}
        <div>
            {{ "form_not_available"|trans({}, "SonataAdminBundle") }}
        </div>
    {% else %}
        <form
{#              {% if __my_form_type == 'horizontal' %}class="form-horizontal"{% endif %}#}
              class="form-horizontal"
              role="form"
              action="{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass')}) }}" {{ form_enctype(form) }}
              method="POST"
              {% if not admin_pool.getOption('html5_validate') %}novalidate="novalidate"{% endif %}
              id="simagd_entity_full_admin_form"
              >
            {% if form.vars.errors|length > 0 %}
                <div class="sonata-ba-form-error">
                    {{ form_errors(form) }}
                </div>
            {% endif %}
{#{{ __my_form_type }}
{{ admin_pool.getOption('form_type') }}
{% if __my_form_type == 'horizontal' %}{{ '<span class="label label-primary-v2">class="form-horizontal"</span><br/>' }}{% endif %}
{% if admin_pool.getOption('form_type') == 'horizontal' %}{{ '<span class="label label-element-v2">class="form-horizontal"</span><br/>' }}{% endif %}#}
            {% block sonata_pre_fieldsets %}
                <div class="row">
            {% endblock %}

            {% block sonata_tab_content %}
                {% set has_tab = ((admin.formtabs|length == 1 and admin.formtabs|keys[0] != 'default') or admin.formtabs|length > 1 ) %}

                {#<span class="label label-element-v2">{ dump(form_tab) }</span>#}
                <div class="col-md-12">
                    {% if has_tab %}
                        <div class="nav-tabs-custom">
                            <ul class="nav nav-pills nav-stacked col-md-3 col-xs-3" role="tablist">
                                {% for name, form_tab in admin.formtabs %}
                                    <li{% if loop.index == 1 %} class="active"{% endif %}><a   href="#tab_{{ loop.index }}" data-toggle="pill"><span class="{{ form_tab.tab_icon|raw }}"></span> {{ admin.trans(name, {}, form_tab.translation_domain) }} <i class="fa"></i></a></li>
                                {% endfor %}
                            </ul>
                            <div class="tab-content col-md-9 col-xs-9">
                                {% for code, form_tab in admin.formtabs %}
                                    <div class="tab-pane fade{% if loop.first %} in active{% endif %}" id="tab_{{ loop.index }}">
                                        <div class="box-body">
                                            <div class="sonata-ba-collapsed-fields">
                                                {% if form_tab.description != false %}
                                                    <p>{{ form_tab.description|raw }}</p>
                                                {% endif %}

                                                {{ form_helper.render_groups(admin, form, form_tab['groups'], has_tab) }}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        {{ form_helper.render_groups(admin, form, admin.formtabs['default'].groups, has_tab) }}
                    {% endif %}
                </div>
            {% endblock %}

            {% block sonata_post_fieldsets %}
                </div>
            {% endblock %}

            {{ form_rest(form) }}

            {% block formactions %}
                <div class="well well-small form-actions">
                    {% if app.request.isxmlhttprequest %}
                        {% if admin.id(object) is not null %}
                            <button type="submit"    class="btn btn-success-v2 btn-outline" name="btn_update"><i class="fa fa-save"></i> {{ 'btn_update'|trans({}, 'SonataAdminBundle') }}</button>
                        {% else %}
                            <button type="submit"    class="btn btn-success-v2 btn-outline" name="btn_create"><i class="fa fa-plus-circle"></i> {{ 'btn_create'|trans({}, 'SonataAdminBundle') }}</button>
                        {% endif %}
                    {% else %}
                        {% if admin.supportsPreviewMode %}
                            <button class="btn btn-info persist-preview" name="btn_preview" type="submit">
                                <i class="fa fa-eye"></i>
                                {{ 'btn_preview'|trans({}, 'SonataAdminBundle') }}
                            </button>
                        {% endif %}
                        {% if admin.id(object) is not null %}
                            <button type="submit"    class="btn btn-primary-v2 btn-outline" name="btn_update_and_edit"><i class="fa fa-save"></i> Guardar</button>

                            {#{% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                <button type="submit"    class="btn btn-primary-v2 btn-outline" name="btn_update_and_list"><i class="fa fa-save"></i> <i class="fa fa-list"></i> Guardar</button>
                            {% endif %}#}

                            {% if admin.hasroute('delete') and admin.isGranted('DELETE', object) %}
                                {{ 'delete_or'|trans({}, 'SonataAdminBundle') }}
                                <a   class="btn btn-danger btn-outline" href="{{ admin.generateObjectUrl('delete', object) }}"><i class="fa fa-minus-circle"></i> {{ 'link_delete'|trans({}, 'SonataAdminBundle') }}</a>
                            {% endif %}

                            {% if admin.isAclEnabled() and admin.hasroute('acl') and admin.isGranted('MASTER', object) %}
                                <a   class="btn btn-info" href="{{ admin.generateObjectUrl('acl', object) }}"><i class="fa fa-users"></i> {{ 'link_edit_acl'|trans({}, 'SonataAdminBundle') }}</a>
                            {% endif %}
                        {% else %}
                            {% if admin.hasroute('edit') and admin.isGranted('EDIT') %}
                                <button class="btn btn-primary-v2 btn-outline" type="submit" name="btn_create_and_edit"><i class="fa fa-save"></i> Guardar</button>
                            {% endif %}
                            {#{% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                <button type="submit"    class="btn btn-primary-v2 btn-outline" name="btn_create_and_list"><i class="fa fa-save"></i> <i class="fa fa-list"></i> Guardar</button>
                            {% endif %}#}
                            {#<button class="btn btn-primary-v2 btn-outline" type="submit" name="btn_create_and_create"><i class="fa fa-plus-circle"></i> Guardar</button>#}
                        {% endif %}
                    {% endif %}
                </div>
            {% endblock formactions %}
        </form>
    {% endif%}

    {{ sonata_block_render_event('sonata.admin.edit.form.bottom', { 'admin': admin, 'object': object }) }}

{% endblock %}